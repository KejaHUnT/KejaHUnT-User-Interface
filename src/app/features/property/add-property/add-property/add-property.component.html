<div class="property-form-container">
  <h2 class="page-title">üè° Add New Property</h2>

  <!-- ‚úÖ Feedback Message -->
  <div *ngIf="message" class="alert-message">
    {{ message }}
  </div>

  <!-- ‚úÖ Property Form -->
  <form (ngSubmit)="onFormSubmit()" class="form-wrapper">

    <!-- üîπ Property Overview -->
    <div class="card-section">
      <h3 class="section-header">Property Details</h3>
      <div class="form-grid">
        <div class="form-group">
          <label>Name</label>
          <input type="text" [(ngModel)]="model.name" name="name" required />
        </div>
        <div class="form-group">
          <label>Location</label>
          <input type="text" [(ngModel)]="model.location" name="location" required />
        </div>
        <div class="form-group">
          <label>Type</label>
          <input type="text" [(ngModel)]="model.type" name="type" required />
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="model.description" name="description" required></textarea>
        </div>

        <!-- üîπ Property Image -->
        <div class="form-group full">
          <label>Property Image</label>
          <input type="file" (change)="onFileSelected($event)" />
          <img *ngIf="propertyImagePreview" [src]="propertyImagePreview" alt="Preview" class="image-preview" />
        </div>
      </div>
    </div>

    <!-- üîπ Property Features -->
    <div class="card-section">
      <h3 class="section-header">Property Features</h3>
      <div class="feature-grid">
        <!-- General -->
        <div class="feature-card">
          <h4>General</h4>
          <ng-container *ngIf="features$ | async as features">
            <div *ngFor="let feature of features" class="checkbox-item">
              <input type="checkbox" [checked]="model.generalFeatures.includes(feature.id)"
                (change)="onGeneralFeatureChange($event, feature.id)" />
              <label>{{ feature.name }}</label>
            </div>
          </ng-container>
        </div>

        <!-- Indoor -->
        <div class="feature-card">
          <h4>Indoor</h4>
          <ng-container *ngIf="indoor$ | async as features">
            <div *ngFor="let feature of features" class="checkbox-item">
              <input type="checkbox" [checked]="model.indoorFeatures.includes(feature.id)"
                (change)="onIndoorFeatureChange($event, feature.id)" />
              <label>{{ feature.name }}</label>
            </div>
          </ng-container>
        </div>

        <!-- Outdoor -->
        <div class="feature-card">
          <h4>Outdoor</h4>
          <ng-container *ngIf="outdoor$ | async as features">
            <div *ngFor="let feature of features" class="checkbox-item">
              <input type="checkbox" [checked]="model.outdoorFeatures.includes(feature.id)"
                (change)="onOutdoorFeatureChange($event, feature.id)" />
              <label>{{ feature.name }}</label>
            </div>
          </ng-container>
        </div>
      </div>
    </div>

    <!-- üîπ Policies -->
    <div class="card-section">
      <h3 class="section-header">Property Policies</h3>
      <div class="policy-masonry">
        <div *ngFor="let policy of policy$ | async" class="policy-card" (click)="onSelectPolicy(policy)">
          <h5>{{ policy.name }}</h5>
          <ul *ngIf="policyDescriptions[policy.id]">
            <li *ngFor="let desc of policyDescriptions[policy.id]; let j = index">
              <span>‚Ä¢ {{ desc }}</span>
              <button type="button" class="remove-btn" (click)="removePolicyDescription(policy.id, j)">√ó</button>
            </li>
          </ul>
          <input [(ngModel)]="newPolicyDescriptionInputs[policy.id]" name="desc_{{policy.id}}"
            placeholder="Add description..." />
          <button type="button" class="add-btn" (click)="onAddPolicyDescription(policy.id)">Add</button>
        </div>
      </div>
    </div>

    <!-- üîπ Units -->
    <div class="card-section">
      <h3 class="section-header">Property Units</h3>
      <div *ngFor="let unit of model.units; let i = index" class="unit-card">
        <div class="form-grid">
          <div class="form-group">
            <label>Type</label>
            <input [(ngModel)]="unit.type" name="unit-type-{{i}}" required />
          </div>
          <div class="form-group">
            <label>Price</label>
            <input type="number" [(ngModel)]="unit.price" name="unit-price-{{i}}" required />
          </div>
          <div class="form-group">
            <label>Bathrooms</label>
            <input type="number" [(ngModel)]="unit.bathrooms" name="unit-bathrooms-{{i}}" required />
          </div>
          <div class="form-group">
            <label>Size (sq ft)</label>
            <input type="number" [(ngModel)]="unit.size" name="unit-size-{{i}}" required />
          </div>
          <div class="form-group">
            <label>Floor</label>
            <input type="number" [(ngModel)]="unit.floor" name="unit-floor-{{i}}" required />
          </div>
          <div class="form-group">
            <label>Door #</label>
            <input [(ngModel)]="unit.doorNumber" name="unit-door-{{i}}" required />
          </div>
          <div class="form-group full">
            <label>Status</label>
            <select [(ngModel)]="unit.status" name="unit-status-{{i}}" required>
              <option value="">Select...</option>
              <option>Available</option>
              <option>Booked</option>
              <option>Reserved</option>
            </select>
          </div>

          <!-- Unit Image -->
          <div class="form-group full">
            <label>Unit Image</label>
            <input type="file" (change)="onUnitFileSelected($event, i)" />
            <img *ngIf="unitImageUrls[i]" [src]="unitImageUrls[i]" alt="Unit" class="image-preview" />
          </div>
        </div>
        <div class="text-end">
          <button type="button" class="remove-btn" (click)="removeUnit(i)">Remove Unit</button>
        </div>
      </div>

      <!-- Add Unit -->
      <button type="button" class="add-btn mt-3" (click)="addUnit()">+ Add Another Unit</button>
    </div>

    <!-- Submit -->
    <div class="form-footer">
      <button type="submit" class="submit-btn">üíæ Submit Property</button>
    </div>
  </form>
</div>
